version: 2

project_name: hg

before:
  hooks:
    - go mod tidy

builds:
  - id: hg
    main: ./cmd/hg
    binary: hg
    env:
      - CGO_ENABLED=0
    goos: [linux, windows, darwin]
    goarch: [amd64, arm64]
    ldflags:
      - -s -w
    mod_timestamp: "{{ .CommitTimestamp }}"

  # musl/Alpine static builds
  - id: hg-musl
    main: ./cmd/hg
    binary: hg
    env:
      - CGO_ENABLED=0
    goos: [linux]
    goarch: [amd64, arm64]
    ldflags:
      - -s -w -extldflags "-static"
    tags:
      - netgo
      - osusergo
    mod_timestamp: "{{ .CommitTimestamp }}"

archives:
  - id: universal
    builds: [hg]
    format: tar.gz
    format_overrides:
      - goos: windows
        format: zip
    wrap_in_directory: false
    files:
      - LICENSE*
      - README.md
    # keep lowercase os/arch in names
    name_template: "hg_{{ .Version }}_{{ .Os }}_{{ .Arch }}"

  # musl/Alpine static archives
  - id: musl
    builds: [hg-musl]
    format: tar.gz
    wrap_in_directory: false
    files:
      - LICENSE*
      - README.md
    name_template: "hg_{{ .Version }}_{{ .Os }}_{{ .Arch }}_musl"

checksum:
  name_template: "checksums.txt"

changelog:
  use: github
  sort: asc
  filters:
    exclude:
      - "^ci:"
      - "^docs:"
      - "^test:"

release:
  draft: false
  prerelease: auto

brews:
  - name: hg
    ids: [universal]
    skip_upload: true
    repository:
      owner: TODO
      name: TODO
      token: "{{ .Env.TAP_GITHUB_TOKEN }}"
    commit_author:
      name: watchthelight-bot
      email: admin@watchthelight.org
    description: "Hypergraph & HoTT tooling in Go"
    homepage: "https://github.com/watchthelight/HypergraphGo"
    license: "MIT"
    install: |
      bin.install "hg"

scoops:
  - name: hg
    ids: [universal]
    skip_upload: true
    repository:
      owner: TODO
      name: TODO
      token: "{{ .Env.SCOOP_GITHUB_TOKEN }}"
    commit_author:
      name: watchthelight-bot
      email: admin@watchthelight.org
    description: "Hypergraph & HoTT tooling in Go"
    homepage: "https://github.com/watchthelight/HypergraphGo"
    license: "MIT"

nfpms:
  - id: deb
    builds: [hg]
    package_name: hypergraphgo
    file_name_template: "{{ .ProjectName }}_{{ .Version }}_{{ .Arch }}.deb"
    vendor: watchthelight
    maintainer: "watchthelight <admin@watchthelight.org>"
    homepage: "https://github.com/watchthelight/HypergraphGo"
    description: "Hypergraph & HoTT tooling in Go"
    license: MIT
    bindir: /usr/bin
    formats:
      - deb

  - id: rpm
    builds: [hg]
    package_name: hypergraphgo
    file_name_template: "{{ .ProjectName }}_{{ .Version }}_{{ .Arch }}.rpm"
    vendor: watchthelight
    maintainer: "watchthelight <admin@watchthelight.org>"
    homepage: "https://github.com/watchthelight/HypergraphGo"
    description: "Hypergraph & HoTT tooling in Go"
    license: MIT
    bindir: /usr/bin
    formats:
      - rpm
